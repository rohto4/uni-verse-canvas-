# èªè¨¼æ©Ÿèƒ½ å®Ÿè£…çŠ¶æ³

Supabase Auth + Google OAuthã«ã‚ˆã‚‹èªè¨¼æ©Ÿèƒ½ã®å®Ÿè£…çŠ¶æ³ã§ã™ã€‚

**æœ€çµ‚æ›´æ–°**: 2026-02-15
**é€²æ—ç‡**: 100%

---

## ğŸ“Š å®Ÿè£…çŠ¶æ³ã‚µãƒãƒªãƒ¼

| æ©Ÿèƒ½ | çŠ¶æ³ | ãƒ•ã‚¡ã‚¤ãƒ« |
|------|------|---------|
| Supabase Authçµ±åˆ | âœ… å®Œäº† | `src/lib/supabase/auth.ts`, `src/lib/supabase/server.ts`, `src/lib/supabase/client.ts` |
| ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ | âœ… å®Œäº† | `src/app/login/page.tsx` |
| ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½ | âœ… å®Œäº† | `src/components/layout/AdminSidebar.tsx` |
| ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç† | âœ… å®Œäº† | `src/middleware.ts`, `src/app/api/auth/callback/route.ts` |
| RLSãƒãƒªã‚·ãƒ¼é©ç”¨ | âœ… å®Œäº† | `supabase/migrations/20260215_add_rls_policies.sql` |

---

## âœ… å®Ÿè£…å®Œäº†æ©Ÿèƒ½

### 1. Supabase Authçµ±åˆ (SSRå¯¾å¿œ)

- âœ… **`@supabase/ssr`ã®å°å…¥**: Next.js App Routerã§ã®ã‚¯ãƒƒã‚­ãƒ¼ãƒ™ãƒ¼ã‚¹ã®èªè¨¼ã«å¯¾å¿œã€‚
- âœ… **Server/Client Client**: `createServerClient` (async) ã¨ `createBrowserClient` ã‚’å®Ÿè£…ã€‚
- âœ… **Auth Helper**: `signInWithGoogle`, `signOut`, `getSessionServer`, `getUserServer`, `isAdminByUid` ã‚’å®Ÿè£…ã€‚

### 2. ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/app/login/page.tsx`

- âœ… Google OAuthãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã€‚
- âœ… ãƒ–ãƒ«ãƒ¼ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–é¢¨ã®æ¸…æ¶¼æ„Ÿã‚ã‚‹ãƒ‡ã‚¶ã‚¤ãƒ³ã€‚
- âœ… ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã®ç®¡ç†ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ï¼‰ã€‚

### 3. ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/components/layout/AdminSidebar.tsx`

- âœ… ã‚µã‚¤ãƒ‰ãƒãƒ¼æœ€ä¸‹éƒ¨ã«ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒœã‚¿ãƒ³ã‚’é…ç½®ã€‚
- âœ… `signOut`ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‘¼ã³å‡ºã—ã€ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤ºã€‚

### 4. ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãƒ»ä¿è­·

- âœ… **Middleware (`src/middleware.ts`)**: 
    - ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®è‡ªå‹•ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ï¼ˆã‚¯ãƒƒã‚­ãƒ¼åŒæœŸï¼‰ã€‚
    - `/admin` é…ä¸‹ã®å…¨ãƒ«ãƒ¼ãƒˆã‚’èªè¨¼å¿…é ˆã«ã€‚
    - ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ `/login` ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸéš›ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã€‚
- âœ… **Auth Callback (`src/app/api/auth/callback/route.ts`)**: 
    - OAuthå¾Œã® `code` ã‚’ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«äº¤æ›ã—ã€ã‚¯ãƒƒã‚­ãƒ¼ã«ä¿å­˜ã€‚

### 5. RLSãƒãƒªã‚·ãƒ¼é©ç”¨

**ãƒ•ã‚¡ã‚¤ãƒ«**: `supabase/migrations/20260215_add_rls_policies.sql`

- âœ… `admins`ãƒ†ãƒ¼ãƒ–ãƒ«ã«åŸºã¥ã„ãŸæ¨©é™ç®¡ç†ã€‚
- âœ… ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€Œå…¬é–‹æ¸ˆã¿ã€è¨˜äº‹ã®ã¿é–²è¦§å¯èƒ½ã€‚
- âœ… ç®¡ç†è€…ã¯å…¨ãƒ†ãƒ¼ãƒ–ãƒ«ã®CRUDãŒå¯èƒ½ã€‚

---

## ğŸ¯ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

èªè¨¼æ©Ÿèƒ½ã®åŸºç›¤ãŒå®Œæˆã—ã¾ã—ãŸã€‚ä»Šå¾Œã¯ã€ç®¡ç†ç”»é¢ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰çµ±è¨ˆæƒ…å ±ã‚„ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ©Ÿèƒ½ã®å®Ÿè£…ã‚’é€²ã‚ã¾ã™ã€‚

---

## ğŸ”— é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯](../lv1/tech-stack.md) - Supabase Auth
- [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](../lv1/architecture_v2.md) - èªè¨¼è¨­è¨ˆ
- [å…¨ä½“æ¦‚è¦](./00-overview.md)
