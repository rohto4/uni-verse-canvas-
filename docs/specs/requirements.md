# UniVerse Canvas — 要件定義 (Lv1)

※ 本ファイルは実装状況に合わせて最新化されています。詳細な実装ステータスは `docs/implementation/00-overview.md`、実装計画は `docs/implementation/_archive/IMPLEMENTATION_PLAN_DETAILED.md` を参照してください。

# docs/requirements.md

## 1. プロジェクト概要

### 1.1 プロジェクト名
**Hyper-Custom Portfolio & Blog System**

### 1.2 目的
個人用の多機能HP兼ブログシステムを構築し、以下を実現する：
- 管理者による高度なコンテンツ管理機能
- 一般ユーザーへの最適化された閲覧体験
- データ損失リスクゼロのバックアップ体制
- ドキュメント駆動開発による長期保守性

### 1.3 開発方針
- **Document Driven Development (DDD)**: 全ての実装は設計ドキュメントに基づく
- **Single Source of Truth (SSOT)**: ドキュメントを常に最新の正解とする
- **型安全性重視**: TypeScript strict modeで厳格な型チェック
- **大規模開発許容**: 10万〜30万行規模のコードベースを想定

---

## 2. システム要件

### 2.1 機能要件

#### 2.1.1 ユーザー種別
| ユーザー種別 | 権限 | 認証方式 |
|------------|------|---------|
| **管理者** | 全機能アクセス可能 | Google OAuth (Supabase Auth) |
| **一般ユーザー** | 公開コンテンツの閲覧のみ | 認証不要 |

#### 2.1.2 コンテンツタイプ

**A. 動的コンテンツ（データベース管理）**

| タイプ | 用途 | 主な機能 |
|-------|------|---------|
| **読み物（posts）** | ブログ・技術記事 | タグ分類、ステータス管理（draft/published/scheduled）、時限投稿 |
| **作ったもの（projects）** | 完成プロジェクト・実績 | カードギャラリー、デモURL・GitHub・技術タグ |
| **進行中のこと（in_progress）** | 現在進行中プロジェクト | ステータス（未着手/中断中/進行中/完了）、ロードマップ |

**B. 固定ページ**
ホーム / 自己紹介 / 関連リンク
（自己紹介・関連リンクは管理画面から編集可能）

#### 2.1.3 コンテンツ管理機能

**Tiptap エディタ機能**
基本編集 / リスト / コードブロック（Lowlight） / 画像 / テーブル / YouTube埋め込み / 装飾（蛍光ペン・文字色・背景色） / 文字数カウント
（KaTeX数式・WebP変換は将来対応）

**メタデータ管理**
タイトル（最大200文字） / スラッグ（自動生成） / 説明文（OGP用、最大300文字） / カバー画像（WebP、最大5MB） / タグ（複数選択可） / 公開日時 / OGP画像

**ステータス管理**
| ステータス | 説明 | 表示条件 |
|----------|------|---------|
| draft | 下書き | 管理者のみ |
| scheduled | 時限投稿 | `published_at <= NOW()` で公開 |
| published | 公開済み | 一般ユーザー閲覧可能 |

#### 2.1.4 画像処理
- ストレージ: Supabase Storage（`images` バケットを共通利用）
- クライアント側圧縮・WebP変換は将来対応

#### 2.1.5 時限投稿
- 判定基準: サーバーサイド時刻のみ
- ISR間隔: 1時間（3600秒）
- 表示ロジック: `published_at <= NOW()` の記事のみ表示

#### 2.1.6 タグフィルタリング
- URL形式: `/posts?tags=tech,diary`
- 複数タグ: AND検索
- UI: PC: サイドバー / スマホ: ドロワーメニュー

#### 2.1.7 Qiita連携（将来）
- API: Qiita API v2（Read-only）
- 取得情報: タイトル、URL、いいね数、公開日
- キャッシュ: Supabase `qiita_cache` テーブル
- 更新: 管理画面から手動更新

#### 2.1.8 バックアップ・エクスポート
- 保存時: JSON + Markdown形式でダウンロード可能
- 全データ: `/admin/backup` から一括エクスポート
- インポート: JSONファイルからDB復元、重複検出・スキップ

#### 2.1.9 検索機能
- タグフィルタ: メイン検索方法（複数タグ対応）
- キーワード検索: `ilike` ベース（タイトル/抜粋/本文）
- Full-Text Search（`pg_trgm` + `to_tsvector`）は将来対応

#### 2.1.10 コメント機能（将来実装）
BOT対策（reCAPTCHA v3） / Rate Limiting（5 req/min） / 管理者承認制

---

### 2.2 非機能要件

| 項目 | 目標値/対策 |
|-----|------------|
| **FCP** | 1.5秒以内 |
| **TTI** | 3秒以内 |
| **Lighthouse** | 90点以上（Performance） |
| **認証** | Supabase Auth（Google OAuth） |
| **認可** | Row Level Security（RLS） |
| **XSS対策** | DOMPurify + Tiptapサニタイズ |
| **Rate Limiting** | API: 100 req/min、画像: 10 files/min |
| **稼働率** | 99.9%（Vercel + Supabase SLA） |
| **テストカバレッジ** | 70%以上（重要ロジックは100%） |
| **記事数想定** | 10,000件以上 |
| **WCAG準拠** | レベルAA |

---

## 3. UI/UX要件

### 3.1 デザイン方針
シンプル・モダン・読みやすさ重視 / ライトモードのみ / レスポンシブ（Mobile First）

### 3.2 ページ別UI仕様
- **ホーム**: ヒーロー、最新記事3件、最新プロジェクト3件、進行中、SNSリンク
- **読み物一覧**: タグフィルタ、記事カード、ページネーション（10件/ページ）、検索ボックス
- **記事詳細**: タイトル・メタ、目次（自動生成）、本文、関連記事、シェアボタン
- **作ったもの**: カードギャラリー、技術タグフィルタ、モーダル詳細
- **進行中**: ステータス別タブ、タイムライン形式、完了→作ったものリンク
- **管理画面**: ダッシュボード、サイドバーナビ、エディタ、プレビュー、バックアップ管理

### 3.3 レスポンシブ
| デバイス | ブレークポイント |
|---------|---------------|
| スマホ | 〜640px |
| タブレット | 641px〜1024px |
| PC | 1025px〜 |

### 3.4 リンク／クリック挙動
- **カード／リスト項目は全面クリック可能**: 記事・プロジェクト・管理一覧などの“詳細へ遷移する単位”はカード全体または行全体をリンク対象にする。
- **タイトルのみリンクは避ける**: 視覚的にカードで表示される場合は、タイトルだけでなく余白もクリック対象に含める。
- **ネストした `<a>` を禁止**: カード内に外部リンクやボタンがある場合は、外側は `onClick + useRouter` で遷移し、内側は `stopPropagation` で競合を防止する。
- **キーボード操作必須**: クリック可能領域には `tabIndex=0` と `role="link"` を付与し、Enter / Space で遷移できるようにする。
- **アクセシブルなフォーカス表示**: フォーカスリングを必ず表示し、視覚的に“リンク領域”が分かるようにする。

---

## 4. データ要件

### 4.1 データベーステーブル（概要）
posts / projects / in_progress / tags / post_tags / project_tags / post_links / post_project_links / pages / qiita_cache

詳細は `docs/specs/data-schema.md` を参照。

---

## 5. 外部連携要件

| サービス | 用途 |
|---------|------|
| Qiita API v2 | 外部記事取得・キャッシュ |
| Google Analytics 4 | アクセス解析 |
| Vercel Analytics | パフォーマンス計測 |
| reCAPTCHA v3 | コメントBOT対策（将来） |

---

## 6. 制約事項

| 項目 | 制約 |
|-----|------|
| Supabase Free Tier | DB: 500MB、Storage: 1GB、Auth: 50,000 MAU |
| Vercel Free Tier | 100GB帯域/月 |
| 画像サイズ | 最大5MB/枚 |
| 管理者 | 単一アカウントのみ |

---

## 7. 今後の拡張機能（優先度順）

**高**: コメント機能、RSS/Atom Feed、サイトマップ自動生成、記事シリーズ機能
**中**: 全文検索強化（Algolia）、多言語対応、記事バージョン管理
**低**: SNS自動投稿、Markdown直接インポート、記事統計ダッシュボード
